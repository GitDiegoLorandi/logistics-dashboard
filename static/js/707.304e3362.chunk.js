"use strict";(self.webpackChunklogistics_dashboard_frontend=self.webpackChunklogistics_dashboard_frontend||[]).push([[707],{3707:(e,s,t)=>{t.r(s),t.d(s,{default:()=>M});var r=t(9643),a=t(9320),l=t(1382),i=t(9382),d=t(5114),n=t(6260),o=t(3964),c=t(3329),m=t(6424),u=t(923),x=t(6207),h=t(4513),g=t(9180),v=t(9920),p=t(7701),y=t(6687),j=t(3217),N=t(893),f=t(3588),b=t(6677),D=t(3527),w=t(529),k=t(3172),I=t(6314),E=t(6507);const A=e=>{let{data:s=[],onEdit:t,onView:l,onDelete:i,userRole:d}=e;const{t:n}=(0,x.Bd)(["deliveries","common"]),o=e=>{let{status:s}=e;const t="PENDING"===s?"Pending":"IN_TRANSIT"===s?"In Transit":"DELIVERED"===s?"Delivered":"CANCELLED"===s?"Cancelled":s,r={Pending:{variant:"warning",label:n("statuses.pending")},"In Transit":{variant:"info",label:n("statuses.inTransit")},Delivered:{variant:"success",label:n("statuses.delivered")},Cancelled:{variant:"default",label:n("statuses.cancelled")},PENDING:{variant:"warning",label:n("statuses.pending")},IN_TRANSIT:{variant:"info",label:n("statuses.inTransit")},DELIVERED:{variant:"success",label:n("statuses.delivered")},CANCELLED:{variant:"default",label:n("statuses.cancelled")}},{variant:a,label:l}=r[t]||{variant:"default",label:t};return(0,E.jsx)(y.E,{variant:a,children:l})},c=e=>{let{priority:s}=e;const t="HIGH"===s?"High":"MEDIUM"===s?"Medium":"LOW"===s?"Low":"URGENT"===s?"Urgent":s,r={High:{variant:"destructive",label:n("priorities.high")},Medium:{variant:"warning",label:n("priorities.medium")},Low:{variant:"default",label:n("priorities.low")},Urgent:{variant:"destructive",label:n("priorities.urgent")},HIGH:{variant:"destructive",label:n("priorities.high")},MEDIUM:{variant:"warning",label:n("priorities.medium")},LOW:{variant:"default",label:n("priorities.low")},URGENT:{variant:"destructive",label:n("priorities.urgent")}},{variant:a,label:l}=r[t]||{variant:"default",label:t};return(0,E.jsx)(y.E,{variant:a,children:l})},m=(0,r.useMemo)((()=>[{accessorKey:"orderId",header:e=>{let{column:s}=e;return(0,E.jsxs)(I.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("orderId"),(0,E.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;return(0,E.jsx)("div",{className:"font-medium",children:s.getValue("orderId")})}},{accessorKey:"customer",header:n("customer"),cell:e=>{let{row:s}=e;return(0,E.jsx)("div",{children:s.getValue("customer")})}},{accessorKey:"deliveryAddress",header:n("address"),cell:e=>{let{row:s}=e;return(0,E.jsx)("div",{className:"max-w-[200px] truncate",title:s.getValue("deliveryAddress"),children:s.getValue("deliveryAddress")})}},{accessorKey:"status",header:e=>{let{column:s}=e;return(0,E.jsxs)(I.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("status"),(0,E.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;return(0,E.jsx)(o,{status:s.getValue("status")})}},{accessorKey:"priority",header:e=>{let{column:s}=e;return(0,E.jsxs)(I.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("priority"),(0,E.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;return(0,E.jsx)(c,{priority:s.getValue("priority")})}},{accessorKey:"deliverer",header:n("deliverer"),cell:e=>{let{row:s}=e;const t=s.original.deliverer;return(0,E.jsx)("div",{children:t?(0,E.jsx)("span",{children:t.name}):(0,E.jsx)("span",{className:"italic text-muted-foreground",children:n("unassigned")})})}},{accessorKey:"estimatedDeliveryDate",header:e=>{let{column:s}=e;return(0,E.jsxs)(I.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("scheduledDate"),(0,E.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;const t=s.getValue("estimatedDeliveryDate");return t?(0,E.jsx)("div",{children:new Date(t).toLocaleDateString()}):(0,E.jsx)("span",{className:"italic text-muted-foreground",children:n("notScheduled")})}},{id:"actions",header:n("actionsHeader",{ns:"common"}),cell:e=>{let{row:s}=e;const r=s.original,a=["admin","manager"].includes(d),o="admin"===d;return(0,E.jsxs)("div",{className:"flex items-center gap-2",children:[(0,E.jsxs)(I.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>l(r),children:[(0,E.jsx)("span",{className:"sr-only",children:n("view",{ns:"common"})}),(0,E.jsx)(b.A,{className:"h-4 w-4"})]}),a&&(0,E.jsxs)(I.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>t(r),children:[(0,E.jsx)("span",{className:"sr-only",children:n("edit",{ns:"common"})}),(0,E.jsx)(D.A,{className:"h-4 w-4"})]}),o&&(0,E.jsxs)(I.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>i(r),children:[(0,E.jsx)("span",{className:"sr-only",children:n("delete",{ns:"common"})}),(0,E.jsx)(w.A,{className:"h-4 w-4"})]})]})}}]),[n,d,l,t,i]),u=(0,j.N4)({data:s,columns:m,getCoreRowModel:(0,N.HT)(),getSortedRowModel:(0,N.h5)(),getFilteredRowModel:(0,N.hM)()});return s&&0!==s.length?(0,E.jsx)("div",{className:"rounded-md border",children:(0,E.jsx)("div",{className:"overflow-x-auto",children:(0,E.jsxs)(k.XI,{children:[(0,E.jsx)(k.A0,{children:u.getHeaderGroups().map((e=>(0,E.jsx)(k.Hj,{children:e.headers.map((e=>(0,E.jsx)(k.nd,{children:e.isPlaceholder?null:(0,j.Kv)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,E.jsx)(k.BF,{children:u.getRowModel().rows.map((e=>(0,E.jsx)(k.Hj,{className:"hover:bg-muted/50",children:e.getVisibleCells().map((e=>(0,E.jsx)(k.nA,{children:(0,j.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))})]})})}):(0,E.jsxs)("div",{className:"rounded-md border bg-muted/10 p-8 text-center",children:[(0,E.jsx)(a.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,E.jsx)("h3",{className:"mt-4 text-lg font-medium",children:n("noDeliveries")}),(0,E.jsx)("p",{className:"mt-1 text-muted-foreground",children:n("noDeliveriesDescription")})]})};var C=t(2616),S=t(1622),R=t(1868);const T=[{_id:"del1",orderId:"ORD-12345",customer:"John Doe",deliveryAddress:"123 Main St, Anytown, CA 90210",status:"Pending",priority:"Medium",estimatedDeliveryDate:"2025-07-15T14:00:00Z",notes:"Leave at front door",deliverer:null},{_id:"del2",orderId:"ORD-67890",customer:"Jane Smith",deliveryAddress:"456 Oak Ave, Somewhere, NY 10001",status:"In Transit",priority:"High",estimatedDeliveryDate:"2025-07-12T10:30:00Z",notes:"Call customer before delivery",deliverer:{_id:"driver1",name:"Michael Brown",phone:"555-456-7890"}},{_id:"del3",orderId:"ORD-54321",customer:"Robert Johnson",deliveryAddress:"789 Pine St, Elsewhere, TX 75001",status:"Delivered",priority:"Low",estimatedDeliveryDate:"2025-07-10T16:45:00Z",notes:"",deliverer:{_id:"driver2",name:"Sarah Johnson",phone:"555-987-6543"}}],L=[{_id:"driver1",name:"Michael Brown",email:"michael.b@example.com",phone:"555-456-7890",status:"Available"},{_id:"driver2",name:"Sarah Johnson",email:"sarah.j@example.com",phone:"555-987-6543",status:"On Delivery"},{_id:"driver3",name:"John Smith",email:"john.smith@example.com",phone:"555-123-4567",status:"Available"}],M=()=>{const{t:e}=(0,x.Bd)(["deliveries","common"]),[s,t]=(0,r.useState)([]),[j,N]=(0,r.useState)([]),[f,b]=(0,r.useState)(!0),[D,w]=(0,r.useState)(null),[k,M]=(0,r.useState)(null),[P,U]=(0,r.useState)(!1),[H,$]=(0,r.useState)(!1),[G,_]=(0,r.useState)("create"),[O,V]=(0,r.useState)(1),[z,q]=(0,r.useState)(1),[F,W]=(0,r.useState)(0),[Z]=(0,r.useState)(10),[K,B]=(0,r.useState)(""),[J,X]=(0,r.useState)(""),[Y,Q]=(0,r.useState)(""),[ee,se]=(0,r.useState)(""),[te,re]=(0,r.useState)(!1),[ae,le]=(0,r.useState)({orderId:"",customer:"",deliveryAddress:"",status:"Pending",priority:"Medium",estimatedDeliveryDate:"",notes:"",deliverer:""}),[ie,de]=(0,r.useState)({customer:!1,deliveryAddress:!1,estimatedDeliveryDate:!1}),[ne,oe]=(0,r.useState)("user");(0,r.useEffect)((()=>{const e=localStorage.getItem("user");if(e){const s=JSON.parse(e);oe(s.role||"user")}}),[]);const ce=(0,r.useCallback)((async()=>{try{b(!0);const e={page:O,limit:Z,...J&&{status:J},...Y&&{priority:Y},...ee&&{deliverer:ee}},s=await h.ZR.getAll(e);t(s.docs||[]),q(s.totalPages||1),W(s.totalDocs||0),w(null)}catch(e){console.error("Error fetching deliveries:",e),w("Failed to fetch deliveries"),u.oR.error("Failed to fetch deliveries. Using demo data instead."),t(T),q(1),W(T.length)}finally{b(!1)}}),[O,Z,J,Y,ee]),me=(0,r.useCallback)((async()=>{try{const e=await h.l1.getAll(),s=e.docs||e||[];N(s)}catch(e){console.error("Error fetching deliverers:",e),u.oR.error("Failed to fetch deliverers. Using demo data instead."),N(L)}}),[]);(0,r.useEffect)((()=>{ce()}),[ce]),(0,r.useEffect)((()=>{me()}),[me]);const ue=s.filter((e=>{var s,t,r;return(null===(s=e.orderId)||void 0===s?void 0:s.toLowerCase().includes(K.toLowerCase()))||(null===(t=e.customer)||void 0===t?void 0:t.toLowerCase().includes(K.toLowerCase()))||(null===(r=e.deliveryAddress)||void 0===r?void 0:r.toLowerCase().includes(K.toLowerCase()))})),xe=(e,s)=>{const t={...ae,[e]:s};if(le(t),"customer"===e)de({...ie,customer:!s.trim()});else if("deliveryAddress"===e)de({...ie,deliveryAddress:!s.trim()});else if("estimatedDeliveryDate"===e){const e=new Date(s),t=new Date;t.setHours(0,0,0,0),de({...ie,estimatedDeliveryDate:e<t})}},he=e=>{var s,t,r;_("edit"),M(e);const a="Pending"===e.status?"PENDING":"In Transit"===e.status?"IN_TRANSIT":"Delivered"===e.status?"DELIVERED":"Cancelled"===e.status?"CANCELLED":(null===(s=e.status)||void 0===s?void 0:s.toUpperCase())||"PENDING",l="Low"===e.priority?"LOW":"Medium"===e.priority?"MEDIUM":"High"===e.priority?"HIGH":"Urgent"===e.priority?"URGENT":(null===(t=e.priority)||void 0===t?void 0:t.toUpperCase())||"MEDIUM";le({orderId:e.orderId||"",customer:e.customer||"",deliveryAddress:e.deliveryAddress||"",status:a,priority:l,estimatedDeliveryDate:e.estimatedDeliveryDate?new Date(e.estimatedDeliveryDate).toISOString().split("T")[0]:"",notes:e.notes||"",deliverer:(null===(r=e.deliverer)||void 0===r?void 0:r._id)||""}),U(!0)},ge=()=>{const e=new Date;e.setDate(e.getDate()+1);const s=e.toISOString().split("T")[0];le({orderId:"",customer:"",deliveryAddress:"",status:"PENDING",priority:"MEDIUM",estimatedDeliveryDate:s,notes:"",deliverer:""}),de({customer:!1,deliveryAddress:!1,estimatedDeliveryDate:!1}),M(null)},ve=e=>{let{status:s}=e;const t="PENDING"===s?"Pending":"IN_TRANSIT"===s?"In Transit":"DELIVERED"===s?"Delivered":"CANCELLED"===s?"Cancelled":s;return(0,E.jsx)(y.E,{className:{Pending:"bg-yellow-100 text-yellow-800","In Transit":"bg-blue-100 text-blue-800",Delivered:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800",PENDING:"bg-yellow-100 text-yellow-800",IN_TRANSIT:"bg-blue-100 text-blue-800",DELIVERED:"bg-green-100 text-green-800",CANCELLED:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800",children:t})},pe=e=>{let{priority:s}=e;const t="HIGH"===s?"High":"MEDIUM"===s?"Medium":"LOW"===s?"Low":"URGENT"===s?"Urgent":s;return(0,E.jsx)(y.E,{className:{Low:"bg-blue-100 text-blue-800",Medium:"bg-yellow-100 text-yellow-800",High:"bg-orange-100 text-orange-800",Urgent:"bg-red-100 text-red-800",LOW:"bg-blue-100 text-blue-800",MEDIUM:"bg-yellow-100 text-yellow-800",HIGH:"bg-orange-100 text-orange-800",URGENT:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800",children:t})};return f&&0===s.length?(0,E.jsx)(g.A,{}):D&&0===s.length?(0,E.jsx)(v.A,{message:D,onRetry:()=>window.location.reload()}):(0,E.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-6",children:[(0,E.jsxs)("div",{className:"mb-8 flex flex-col gap-6 rounded-xl bg-card p-6 shadow md:flex-row md:items-start md:justify-between",children:[(0,E.jsxs)("div",{children:[(0,E.jsxs)("h1",{className:"flex items-center gap-2 text-2xl font-bold",children:[(0,E.jsx)(a.A,{className:"h-6 w-6 text-primary"}),e("title")]}),(0,E.jsx)("p",{className:"text-muted-foreground",children:e("deliveryDetails")})]}),(0,E.jsxs)("div",{className:"flex gap-2",children:[(0,E.jsxs)(I.$,{variant:"outline",size:"sm",onClick:ce,disabled:f,className:"flex items-center gap-2",children:[(0,E.jsx)(l.A,{className:f?"h-4 w-4 animate-spin":"h-4 w-4"}),e("common:refresh")]}),(0,E.jsxs)(I.$,{onClick:()=>{_("create"),ge();const e=new Date;e.setDate(e.getDate()+1);const s=e.toISOString().split("T")[0];le((e=>({...e,estimatedDeliveryDate:s,status:"PENDING"}))),U(!0)},size:"sm",className:"flex items-center gap-2",children:[(0,E.jsx)(i.A,{className:"h-4 w-4"})," ",e("newDelivery")]})]})]}),(0,E.jsxs)("div",{className:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center",children:[(0,E.jsxs)("div",{className:"relative w-full md:max-w-md",children:[(0,E.jsx)(d.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,E.jsx)(C.p,{type:"text",placeholder:e("deliveries:destinationPlaceholder"),value:K,onChange:e=>B(e.target.value),className:"pl-10"})]}),(0,E.jsxs)("div",{className:"flex items-center gap-2",children:[(0,E.jsxs)(I.$,{variant:te?"default":"outline",size:"sm",className:"flex items-center gap-2",onClick:()=>re(!te),children:[(0,E.jsx)(n.A,{className:"h-4 w-4"}),e("common:filter")]}),(J||Y||ee)&&(0,E.jsxs)(I.$,{variant:"destructive",size:"sm",className:"flex items-center gap-2",onClick:()=>{X(""),Q(""),se(""),B(""),V(1)},children:[(0,E.jsx)(o.A,{className:"h-4 w-4"}),e("common:clear")]})]})]}),te&&(0,E.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-6 rounded-xl bg-card p-6 shadow md:grid-cols-3",children:[(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium",children:e("status")}),(0,E.jsxs)(S.l,{value:J,onChange:e=>X(e.target.value),className:"w-full dark:border-gray-700 dark:bg-gray-800 dark:text-white",children:[(0,E.jsx)("option",{value:"",children:e("filters.all")}),(0,E.jsx)("option",{value:"Pending",children:e("statuses.pending")}),(0,E.jsx)("option",{value:"In Transit",children:e("statuses.inTransit")}),(0,E.jsx)("option",{value:"Delivered",children:e("statuses.delivered")}),(0,E.jsx)("option",{value:"Cancelled",children:e("statuses.cancelled")})]})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium",children:e("priority")}),(0,E.jsxs)(S.l,{value:Y,onChange:e=>Q(e.target.value),className:"w-full dark:border-gray-700 dark:bg-gray-800 dark:text-white",children:[(0,E.jsx)("option",{value:"",children:e("filters.all")}),(0,E.jsx)("option",{value:"Low",children:e("priorities.low")}),(0,E.jsx)("option",{value:"Medium",children:e("priorities.medium")}),(0,E.jsx)("option",{value:"High",children:e("priorities.high")}),(0,E.jsx)("option",{value:"Urgent",children:e("priorities.urgent")})]})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium",children:e("deliverer")}),(0,E.jsxs)(S.l,{value:ee,onChange:e=>se(e.target.value),className:"w-full dark:border-gray-700 dark:bg-gray-800 dark:text-white",children:[(0,E.jsx)("option",{value:"",children:e("filters.all")}),j.map((e=>(0,E.jsx)("option",{value:e._id,children:e.name},e._id)))]})]})]}),(0,E.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,E.jsx)(R.Zp,{children:(0,E.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,E.jsx)("span",{className:"text-3xl font-bold",children:F}),(0,E.jsx)("span",{className:"text-sm text-muted-foreground",children:e("deliveriesTotal",{ns:"dashboard"})})]})}),(0,E.jsx)(R.Zp,{children:(0,E.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,E.jsx)("span",{className:"text-3xl font-bold",children:ue.filter((e=>"PENDING"===e.status||"Pending"===e.status)).length}),(0,E.jsx)("span",{className:"text-sm text-muted-foreground",children:e("statuses.pending")})]})}),(0,E.jsx)(R.Zp,{children:(0,E.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,E.jsx)("span",{className:"text-3xl font-bold",children:ue.filter((e=>"IN_TRANSIT"===e.status||"In Transit"===e.status)).length}),(0,E.jsx)("span",{className:"text-sm text-muted-foreground",children:e("statuses.inTransit")})]})}),(0,E.jsx)(R.Zp,{children:(0,E.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,E.jsx)("span",{className:"text-3xl font-bold",children:ue.filter((e=>"DELIVERED"===e.status||"Delivered"===e.status)).length}),(0,E.jsx)("span",{className:"text-sm text-muted-foreground",children:e("statuses.delivered")})]})})]}),(0,E.jsx)(A,{data:ue,loading:f,onView:e=>{M(e),$(!0)},onEdit:he,onDelete:async e=>{if(window.confirm("Are you sure you want to delete this delivery?"))try{const s="object"===typeof e?e._id:e;if(!s)return console.error("Invalid delivery ID:",s),void u.oR.error("Cannot delete delivery: Invalid ID");await h.ZR.delete(s),u.oR.success("Delivery deleted successfully!"),ce()}catch(s){console.error("Error deleting delivery:",s),u.oR.error(`Failed to delete delivery: ${s.message||"Unknown error"}`)}},userRole:ne}),z>1&&(0,E.jsxs)("div",{className:"mb-6 flex items-center justify-between py-4",children:[(0,E.jsxs)(I.$,{variant:"outline",size:"sm",onClick:()=>V((e=>Math.max(e-1,1))),disabled:1===O,className:"flex items-center gap-1",children:[(0,E.jsx)(c.A,{className:"h-4 w-4"}),e("common:previous")]}),(0,E.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e("common:page")," ",O," ",e("common:of")," ",z," (",F," ",e("common:total"),")"]}),(0,E.jsxs)(I.$,{variant:"outline",size:"sm",onClick:()=>V((e=>Math.min(e+1,z))),disabled:O===z,className:"flex items-center gap-1",children:[e("common:next"),(0,E.jsx)(m.A,{className:"h-4 w-4"})]})]}),P&&(0,E.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:(0,E.jsxs)("div",{className:"max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-lg bg-white p-6 text-black shadow-xl dark:bg-gray-800 dark:text-white",children:[(0,E.jsxs)("div",{className:"mb-4 flex items-center justify-between border-b border-gray-200 pb-4 dark:border-gray-700",children:[(0,E.jsx)("h3",{className:"text-xl font-semibold",children:e("create"===G?"newDelivery":"editDelivery")}),(0,E.jsx)("button",{className:"rounded-full p-1 hover:bg-muted",onClick:()=>U(!1),children:(0,E.jsx)(o.A,{size:24})})]}),(0,E.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{var s;b(!0);const e=!ae.customer.trim(),l=!ae.deliveryAddress.trim(),i=new Date(ae.estimatedDeliveryDate),d=new Date;d.setHours(0,0,0,0);const n=i<d;if(de({customer:e,deliveryAddress:l,estimatedDeliveryDate:n}),e||l||n)return void b(!1);const o=e=>{switch(e){case"PENDING":return"Pending";case"IN_TRANSIT":return"In Transit";case"DELIVERED":return"Delivered";case"CANCELLED":return"Cancelled";default:return e}},c=e=>{switch(e){case"LOW":return"Low";case"MEDIUM":return"Medium";case"HIGH":return"High";case"URGENT":return"Urgent";default:return e}},m="create"===G?{customer:ae.customer,deliveryAddress:ae.deliveryAddress,status:o(ae.status),priority:c(ae.priority),estimatedDeliveryDate:ae.estimatedDeliveryDate?new Date(ae.estimatedDeliveryDate).toISOString():void 0,notes:ae.notes,deliverer:ae.deliverer||void 0}:{...ae,status:o(ae.status),priority:c(ae.priority),estimatedDeliveryDate:ae.estimatedDeliveryDate?new Date(ae.estimatedDeliveryDate).toISOString():void 0,deliverer:ae.deliverer||void 0},x="edit"===G?null===(s=k.deliverer)||void 0===s?void 0:s._id:null;if("create"===G)try{localStorage.getItem("authToken"),await h.ZR.create(m);u.oR.success("Delivery created successfully!"),U(!1),ge(),setTimeout((()=>{ce()}),300)}catch(a){console.error("Error creating delivery:",a),console.error("Error details:",JSON.stringify(a,null,2)),a.data&&a.data.errors&&Array.isArray(a.data.errors)?a.data.errors.forEach((e=>{u.oR.error(`${e.field}: ${e.message}`)})):a.data&&a.data.message?(console.log("Error message from API:",a.data.message),u.oR.error(a.data.message)):a.message?(console.log("Error message:",a.message),u.oR.error(a.message)):(console.log("Unknown error format:",a),u.oR.error("Failed to create delivery. Please check your input and try again.")),b(!1)}else try{if(await h.ZR.update(k._id,m),u.oR.success("Delivery updated successfully!"),ae.deliverer&&ae.deliverer!==x)try{await h.l1.updateStatus(ae.deliverer,"Busy")}catch(a){console.error("Error updating deliverer status:",a)}if(x&&x!==ae.deliverer)try{await h.l1.updateStatus(x,"Available")}catch(a){console.error("Error updating deliverer status:",a)}U(!1),ge(),ce()}catch(a){var t,r;console.error("Error updating delivery:",a),null!==(t=a.response)&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&r.message?u.oR.error(a.response.data.message):a.message?u.oR.error(a.message):u.oR.error("Failed to update delivery"),b(!1)}}catch(a){console.error("Unexpected error:",a),u.oR.error("An unexpected error occurred"),b(!1)}},className:"space-y-4",children:["edit"===G&&(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("deliveryID")," *"]}),(0,E.jsx)("input",{type:"text",value:ae.orderId,onChange:e=>le({...ae,orderId:e.target.value}),required:!0,disabled:!0,placeholder:e("common:autoGenerated"),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-700 dark:bg-gray-800 dark:text-white"})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("customer")," *"]}),(0,E.jsx)("input",{type:"text",value:ae.customer,onChange:e=>xe("customer",e.target.value),required:!0,placeholder:e("customerPlaceholder"),className:`w-full rounded-md border ${ie.customer?"border-red-500":"border-input"} bg-background px-3 py-2 text-foreground dark:border-gray-700 dark:bg-gray-800 dark:text-white`}),ie.customer&&(0,E.jsx)("p",{className:"text-sm text-red-500",children:e("validation.required",{fallback:"Customer name is required"})})]})]}),"create"===G&&(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("customer")," *"]}),(0,E.jsx)("input",{type:"text",value:ae.customer,onChange:e=>xe("customer",e.target.value),required:!0,placeholder:e("customerPlaceholder"),className:`w-full rounded-md border ${ie.customer?"border-red-500":"border-input"} bg-background px-3 py-2 text-foreground dark:border-gray-700 dark:bg-gray-800 dark:text-white`}),ie.customer&&(0,E.jsx)("p",{className:"text-sm text-red-500",children:e("validation.required",{fallback:"Customer name is required"})})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("destination")," *"]}),(0,E.jsx)(p.A,{value:ae.deliveryAddress,onChange:e=>xe("deliveryAddress",e),placeholder:e("destinationPlaceholder"),disabled:f,className:ie.deliveryAddress?"border-red-500":""}),ie.deliveryAddress&&(0,E.jsx)("p",{className:"text-sm text-red-500",children:e("validation.required",{fallback:"Delivery address is required"})}),(0,E.jsx)("small",{className:"text-xs text-muted-foreground",children:e("deliverers:startTypingForSuggestions")})]}),(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:["edit"===G&&(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("status")}),(0,E.jsxs)(S.l,{value:ae.status,onChange:e=>le({...ae,status:e.target.value}),className:"w-full dark:border-gray-700 dark:bg-gray-800 dark:text-white",children:[(0,E.jsx)("option",{value:"PENDING",children:e("statuses.pending")}),(0,E.jsx)("option",{value:"IN_TRANSIT",children:e("statuses.inTransit")}),(0,E.jsx)("option",{value:"DELIVERED",children:e("statuses.delivered")}),(0,E.jsx)("option",{value:"CANCELLED",children:e("statuses.cancelled")})]})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("priority")}),(0,E.jsxs)(S.l,{value:ae.priority,onChange:e=>le({...ae,priority:e.target.value}),className:"w-full dark:border-gray-700 dark:bg-gray-800 dark:text-white",children:[(0,E.jsx)("option",{value:"LOW",children:e("priorities.low")}),(0,E.jsx)("option",{value:"MEDIUM",children:e("priorities.medium")}),(0,E.jsx)("option",{value:"HIGH",children:e("priorities.high")}),(0,E.jsx)("option",{value:"URGENT",children:e("priorities.urgent")})]})]})]}),(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("scheduledDate")," *"]}),(0,E.jsx)("input",{type:"date",value:ae.estimatedDeliveryDate,onChange:e=>xe("estimatedDeliveryDate",e.target.value),min:(new Date).toISOString().split("T")[0],required:!0,className:`w-full rounded-md border ${ie.estimatedDeliveryDate?"border-red-500":"border-input"} bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700`}),ie.estimatedDeliveryDate&&(0,E.jsx)("p",{className:"text-sm text-red-500",children:e("validation.futureDateRequired",{fallback:"Date must be in the future"})}),(0,E.jsx)("small",{className:"text-xs text-muted-foreground",children:e("common:mustBeFutureDate")})]}),"admin"===ne&&(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("deliverer")}),(0,E.jsxs)(S.l,{value:ae.deliverer,onChange:e=>le({...ae,deliverer:e.target.value}),className:"w-full dark:border-gray-700 dark:bg-gray-800 dark:text-white",children:[(0,E.jsx)("option",{value:"",children:e("unassigned")}),j.filter((e=>"Available"===e.status)).map((e=>(0,E.jsxs)("option",{value:e._id,children:[e.name," - ",e.email]},e._id)))]}),0===j.filter((e=>"Available"===e.status)).length&&(0,E.jsx)("small",{className:"text-xs text-warning",children:e("common:noAvailableDeliverers")})]})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("notes")}),(0,E.jsx)("textarea",{value:ae.notes,onChange:e=>le({...ae,notes:e.target.value}),placeholder:e("notesPlaceholder"),rows:"3",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-700 dark:bg-gray-800 dark:text-white"})]}),(0,E.jsxs)("div",{className:"flex justify-end space-x-3 border-t border-gray-200 pt-4 dark:border-gray-700",children:[(0,E.jsx)(I.$,{type:"button",variant:"outline",onClick:()=>U(!1),children:e("deliverers:cancel")}),(0,E.jsx)(I.$,{type:"submit",disabled:f,children:f?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(l.A,{className:"mr-2 h-4 w-4 animate-spin"}),e("create"===G?"common:creating":"common:updating")]}):e("create"===G?"newDelivery":"editDelivery")})]})]})]})}),H&&k&&(0,E.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:(0,E.jsxs)("div",{className:"max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-lg bg-white p-6 text-black shadow-xl dark:bg-gray-800 dark:text-white",children:[(0,E.jsxs)("div",{className:"mb-4 flex items-center justify-between border-b border-gray-200 pb-4 dark:border-gray-700",children:[(0,E.jsx)("h3",{className:"text-xl font-semibold",children:e("deliveryDetails")}),(0,E.jsx)("button",{className:"rounded-full p-1 hover:bg-muted",onClick:()=>$(!1),children:(0,E.jsx)(o.A,{size:24})})]}),(0,E.jsxs)("div",{className:"space-y-6",children:[(0,E.jsxs)("div",{className:"space-y-3",children:[(0,E.jsx)("h4",{className:"text-lg font-medium",children:e("common:basicInfo")}),(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("deliveryID")}),(0,E.jsx)("p",{className:"font-medium",children:k.orderId})]}),(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("customer")}),(0,E.jsx)("p",{className:"font-medium",children:k.customer})]}),(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("status")}),(0,E.jsx)("div",{children:(0,E.jsx)(ve,{status:k.status})})]}),(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("priority")}),(0,E.jsx)("div",{children:(0,E.jsx)(pe,{priority:k.priority})})]})]})]}),(0,E.jsxs)("div",{className:"space-y-3",children:[(0,E.jsx)("h4",{className:"text-lg font-medium",children:e("deliveryInformation")}),(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("deliveryAddress")}),(0,E.jsx)("p",{className:"font-medium",children:k.deliveryAddress||"No address provided"})]}),(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("estimatedDate")}),(0,E.jsx)("p",{className:"font-medium",children:k.estimatedDeliveryDate?new Date(k.estimatedDeliveryDate).toLocaleDateString():"Not set"})]}),(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("actualDate")}),(0,E.jsx)("p",{className:"font-medium",children:k.actualDeliveryDate?new Date(k.actualDeliveryDate).toLocaleDateString():"Not delivered yet"})]})]})]})]}),(0,E.jsxs)("div",{className:"space-y-3",children:[(0,E.jsx)("h4",{className:"text-lg font-medium",children:e("assignmentTracking")}),(0,E.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("assignedDeliverer")}),(0,E.jsx)("p",{className:"font-medium",children:k.deliverer?`${k.deliverer.name} (${k.deliverer.email})`:"Unassigned"})]}),(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsx)("label",{className:"text-sm text-muted-foreground",children:e("createdDate")}),(0,E.jsx)("p",{className:"font-medium",children:new Date(k.createdAt).toLocaleDateString()})]})]})]}),k.notes&&(0,E.jsxs)("div",{className:"space-y-3",children:[(0,E.jsx)("h4",{className:"text-lg font-medium",children:e("notes")}),(0,E.jsx)("p",{children:k.notes})]}),(0,E.jsxs)("div",{className:"flex justify-end space-x-3 border-t border-gray-200 pt-4 dark:border-gray-700",children:["admin"===ne&&(0,E.jsx)(I.$,{variant:"outline",onClick:()=>{$(!1),he(k)},children:e("editDelivery")}),(0,E.jsx)(I.$,{onClick:()=>$(!1),children:e("close")})]})]})]})})]})}},7701:(e,s,t)=>{t.d(s,{A:()=>o});var r=t(9643),a=t(2616),l=t(7142),i=t(2732),d=t(3016),n=t(6507);const o=e=>{let{value:s,onChange:t,onSelect:o,placeholder:c="Enter an address",className:m="",inputClassName:u="",disabled:x=!1,required:h=!1,...g}=e;const[v,p]=(0,r.useState)([]),[y,j]=(0,r.useState)(!1),[N,f]=(0,r.useState)(!1),[b,D]=(0,r.useState)(!1),w=(0,r.useRef)(null),k=(0,r.useRef)(null),I=(0,r.useRef)(null);(0,r.useEffect)((()=>{function e(e){k.current&&!k.current.contains(e.target)&&p([])}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);return(0,n.jsxs)("div",{className:`relative ${m}`,...g,children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(a.p,{ref:w,type:"text",value:s||"",onChange:e=>{const s=e.target.value;t&&t(s),I.current&&clearTimeout(I.current),s.length>=3?(j(!0),I.current=setTimeout((()=>{(async e=>{if(e&&!(e.length<3)){j(!0);try{const s=`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(e)}&apiKey=6d177e3213d4451d87c9e1561ee3b8d3&format=json&limit=5`,t=await fetch(s);if(!t.ok)throw new Error(`Geoapify API error: ${t.status}`);const r=await t.json();if(r&&r.results){const e=r.results.map((e=>({formattedAddress:e.formatted,lat:e.lat,lon:e.lon,country:e.country,state:e.state,city:e.city,street:e.street,houseNumber:e.housenumber,postcode:e.postcode,raw:e})));p(e)}else p([])}catch(s){console.error("Error fetching address suggestions:",s),D(!0),p([])}finally{j(!1)}}})(s)}),300)):(p([]),j(!1))},placeholder:b?"Enter address manually":c,className:`pl-10 ${u}`,disabled:x,required:h,onFocus:()=>f(!0),onBlur:()=>setTimeout((()=>f(!1)),200)}),(0,n.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:y?(0,n.jsx)(l.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}):b?(0,n.jsx)(i.A,{className:"h-4 w-4 text-amber-500"}):(0,n.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"})})]}),b&&(0,n.jsx)("div",{className:"mt-1 text-xs text-amber-500",children:"Address autocomplete unavailable. Please enter address manually."}),N&&v.length>0&&(0,n.jsx)("div",{ref:k,className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border bg-white py-1 shadow-lg dark:bg-gray-800 dark:text-white dark:border-gray-700",children:v.map(((e,s)=>(0,n.jsxs)("div",{className:"cursor-pointer px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>(e=>{t&&t(e.formattedAddress),o&&o(e),p([])})(e),children:[(0,n.jsx)("div",{className:"font-medium",children:e.formattedAddress}),e.city&&e.country&&(0,n.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.city,e.state,e.country].filter(Boolean).join(", ")})]},s)))})]})}}}]);
//# sourceMappingURL=707.304e3362.chunk.js.map
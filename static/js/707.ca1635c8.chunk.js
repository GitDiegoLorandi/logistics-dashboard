"use strict";(self.webpackChunklogistics_dashboard_frontend=self.webpackChunklogistics_dashboard_frontend||[]).push([[707],{3707:(e,s,r)=>{r.r(s),r.d(s,{default:()=>M});var t=r(9643),a=r(9320),l=r(1382),i=r(9382),d=r(5114),n=r(6260),o=r(3964),c=r(3329),m=r(6424),u=r(923),x=r(6207),g=r(4513),h=r(9180),v=r(9920),p=r(7701),y=r(6687),j=r(3217),N=r(893),f=r(3588),b=r(6677),D=r(3527),w=r(529),I=r(3172),E=r(6314),A=r(6507);const k=e=>{let{data:s=[],onEdit:r,onView:l,onDelete:i,userRole:d}=e;const{t:n}=(0,x.Bd)(["deliveries","common"]),o=e=>{let{status:s}=e;const r="PENDING"===s?"Pending":"IN_TRANSIT"===s?"In Transit":"DELIVERED"===s?"Delivered":"CANCELLED"===s?"Cancelled":s,t={Pending:{variant:"warning",label:n("statuses.pending")},"In Transit":{variant:"info",label:n("statuses.inTransit")},Delivered:{variant:"success",label:n("statuses.delivered")},Cancelled:{variant:"default",label:n("statuses.cancelled")},PENDING:{variant:"warning",label:n("statuses.pending")},IN_TRANSIT:{variant:"info",label:n("statuses.inTransit")},DELIVERED:{variant:"success",label:n("statuses.delivered")},CANCELLED:{variant:"default",label:n("statuses.cancelled")}},{variant:a,label:l}=t[r]||{variant:"default",label:r};return(0,A.jsx)(y.E,{variant:a,children:l})},c=e=>{let{priority:s}=e;const r="HIGH"===s?"High":"MEDIUM"===s?"Medium":"LOW"===s?"Low":"URGENT"===s?"Urgent":s,t={High:{variant:"destructive",label:n("priorities.high")},Medium:{variant:"warning",label:n("priorities.medium")},Low:{variant:"default",label:n("priorities.low")},Urgent:{variant:"destructive",label:n("priorities.urgent")},HIGH:{variant:"destructive",label:n("priorities.high")},MEDIUM:{variant:"warning",label:n("priorities.medium")},LOW:{variant:"default",label:n("priorities.low")},URGENT:{variant:"destructive",label:n("priorities.urgent")}},{variant:a,label:l}=t[r]||{variant:"default",label:r};return(0,A.jsx)(y.E,{variant:a,children:l})},m=(0,t.useMemo)((()=>[{accessorKey:"orderId",header:e=>{let{column:s}=e;return(0,A.jsxs)(E.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("orderId"),(0,A.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;return(0,A.jsx)("div",{className:"font-medium",children:s.getValue("orderId")})}},{accessorKey:"customer",header:n("customer"),cell:e=>{let{row:s}=e;return(0,A.jsx)("div",{children:s.getValue("customer")})}},{accessorKey:"deliveryAddress",header:n("address"),cell:e=>{let{row:s}=e;return(0,A.jsx)("div",{className:"max-w-[200px] truncate",title:s.getValue("deliveryAddress"),children:s.getValue("deliveryAddress")})}},{accessorKey:"status",header:e=>{let{column:s}=e;return(0,A.jsxs)(E.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("status"),(0,A.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;return(0,A.jsx)(o,{status:s.getValue("status")})}},{accessorKey:"priority",header:e=>{let{column:s}=e;return(0,A.jsxs)(E.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("priority"),(0,A.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;return(0,A.jsx)(c,{priority:s.getValue("priority")})}},{accessorKey:"deliverer",header:n("deliverer"),cell:e=>{let{row:s}=e;const r=s.original.deliverer;return(0,A.jsx)("div",{children:r?(0,A.jsx)("span",{children:r.name}):(0,A.jsx)("span",{className:"italic text-muted-foreground",children:n("unassigned")})})}},{accessorKey:"estimatedDeliveryDate",header:e=>{let{column:s}=e;return(0,A.jsxs)(E.$,{variant:"ghost",onClick:()=>s.toggleSorting("asc"===s.getIsSorted()),className:"p-0 hover:bg-transparent",children:[n("scheduledDate"),(0,A.jsx)(f.A,{className:"ml-2 h-4 w-4"})]})},cell:e=>{let{row:s}=e;const r=s.getValue("estimatedDeliveryDate");return r?(0,A.jsx)("div",{children:new Date(r).toLocaleDateString()}):(0,A.jsx)("span",{className:"italic text-muted-foreground",children:n("notScheduled")})}},{id:"actions",header:n("actionsHeader",{ns:"common"}),cell:e=>{let{row:s}=e;const t=s.original,a=["admin","manager"].includes(d),o="admin"===d;return(0,A.jsxs)("div",{className:"flex items-center gap-2",children:[(0,A.jsxs)(E.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>l(t),children:[(0,A.jsx)("span",{className:"sr-only",children:n("view",{ns:"common"})}),(0,A.jsx)(b.A,{className:"h-4 w-4"})]}),a&&(0,A.jsxs)(E.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>r(t),children:[(0,A.jsx)("span",{className:"sr-only",children:n("edit",{ns:"common"})}),(0,A.jsx)(D.A,{className:"h-4 w-4"})]}),o&&(0,A.jsxs)(E.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>i(t),children:[(0,A.jsx)("span",{className:"sr-only",children:n("delete",{ns:"common"})}),(0,A.jsx)(w.A,{className:"h-4 w-4"})]})]})}}]),[n,d,l,r,i]),u=(0,j.N4)({data:s,columns:m,getCoreRowModel:(0,N.HT)(),getSortedRowModel:(0,N.h5)(),getFilteredRowModel:(0,N.hM)()});return s&&0!==s.length?(0,A.jsx)("div",{className:"rounded-md border",children:(0,A.jsx)("div",{className:"overflow-x-auto",children:(0,A.jsxs)(I.XI,{children:[(0,A.jsx)(I.A0,{children:u.getHeaderGroups().map((e=>(0,A.jsx)(I.Hj,{children:e.headers.map((e=>(0,A.jsx)(I.nd,{children:e.isPlaceholder?null:(0,j.Kv)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,A.jsx)(I.BF,{children:u.getRowModel().rows.map((e=>(0,A.jsx)(I.Hj,{className:"hover:bg-muted/50",children:e.getVisibleCells().map((e=>(0,A.jsx)(I.nA,{children:(0,j.Kv)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))})]})})}):(0,A.jsxs)("div",{className:"rounded-md border bg-muted/10 p-8 text-center",children:[(0,A.jsx)(a.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,A.jsx)("h3",{className:"mt-4 text-lg font-medium",children:n("noDeliveries")}),(0,A.jsx)("p",{className:"mt-1 text-muted-foreground",children:n("noDeliveriesDescription")})]})};var C=r(2616),S=r(1622),R=r(1868);const T=[{_id:"del1",orderId:"ORD-12345",customer:"John Doe",deliveryAddress:"123 Main St, Anytown, CA 90210",status:"Pending",priority:"Medium",estimatedDeliveryDate:"2025-07-15T14:00:00Z",notes:"Leave at front door",deliverer:null},{_id:"del2",orderId:"ORD-67890",customer:"Jane Smith",deliveryAddress:"456 Oak Ave, Somewhere, NY 10001",status:"In Transit",priority:"High",estimatedDeliveryDate:"2025-07-12T10:30:00Z",notes:"Call customer before delivery",deliverer:{_id:"driver1",name:"Michael Brown",phone:"555-456-7890"}},{_id:"del3",orderId:"ORD-54321",customer:"Robert Johnson",deliveryAddress:"789 Pine St, Elsewhere, TX 75001",status:"Delivered",priority:"Low",estimatedDeliveryDate:"2025-07-10T16:45:00Z",notes:"",deliverer:{_id:"driver2",name:"Sarah Johnson",phone:"555-987-6543"}}],L=[{_id:"driver1",name:"Michael Brown",email:"michael.b@example.com",phone:"555-456-7890",status:"Available"},{_id:"driver2",name:"Sarah Johnson",email:"sarah.j@example.com",phone:"555-987-6543",status:"On Delivery"},{_id:"driver3",name:"John Smith",email:"john.smith@example.com",phone:"555-123-4567",status:"Available"}],M=()=>{const{t:e}=(0,x.Bd)(["deliveries","common"]),[s,r]=(0,t.useState)([]),[j,N]=(0,t.useState)([]),[f,b]=(0,t.useState)(!0),[D,w]=(0,t.useState)(null),[I,M]=(0,t.useState)(null),[P,U]=(0,t.useState)(!1),[$,G]=(0,t.useState)(!1),[H,_]=(0,t.useState)("create"),[V,O]=(0,t.useState)(1),[z,F]=(0,t.useState)(1),[W,Z]=(0,t.useState)(0),[q]=(0,t.useState)(10),[B,K]=(0,t.useState)(""),[J,X]=(0,t.useState)(""),[Y,Q]=(0,t.useState)(""),[ee,se]=(0,t.useState)(""),[re,te]=(0,t.useState)(!1),[ae,le]=(0,t.useState)({orderId:"",customer:"",deliveryAddress:"",status:"Pending",priority:"Medium",estimatedDeliveryDate:"",notes:"",deliverer:""}),[ie,de]=(0,t.useState)("user");(0,t.useEffect)((()=>{const e=localStorage.getItem("user");if(e){const s=JSON.parse(e);de(s.role||"user")}}),[]);const ne=(0,t.useCallback)((async()=>{try{b(!0);const e={page:V,limit:q,...J&&{status:J},...Y&&{priority:Y},...ee&&{deliverer:ee}},s=await g.ZR.getAll(e);r(s.docs||[]),F(s.totalPages||1),Z(s.totalDocs||0),w(null)}catch(e){console.error("Error fetching deliveries:",e),w("Failed to fetch deliveries"),u.oR.error("Failed to fetch deliveries. Using demo data instead."),r(T),F(1),Z(T.length)}finally{b(!1)}}),[V,q,J,Y,ee]),oe=(0,t.useCallback)((async()=>{try{const e=await g.l1.getAll(),s=e.docs||e||[];N(s)}catch(e){console.error("Error fetching deliverers:",e),u.oR.error("Failed to fetch deliverers. Using demo data instead."),N(L)}}),[]);(0,t.useEffect)((()=>{ne()}),[ne]),(0,t.useEffect)((()=>{oe()}),[oe]);const ce=s.filter((e=>{var s,r,t;return(null===(s=e.orderId)||void 0===s?void 0:s.toLowerCase().includes(B.toLowerCase()))||(null===(r=e.customer)||void 0===r?void 0:r.toLowerCase().includes(B.toLowerCase()))||(null===(t=e.deliveryAddress)||void 0===t?void 0:t.toLowerCase().includes(B.toLowerCase()))}));(0,t.useEffect)((()=>{console.log("Deliveries state:",s),console.log("Filtered deliveries:",ce),console.log("Search term:",B),console.log("Status filter:",J),console.log("Priority filter:",Y),console.log("Deliverer filter:",ee)}),[s,ce,B,J,Y,ee]);const me=e=>{var s,r,t;_("edit"),M(e);const a="Pending"===e.status?"PENDING":"In Transit"===e.status?"IN_TRANSIT":"Delivered"===e.status?"DELIVERED":"Cancelled"===e.status?"CANCELLED":(null===(s=e.status)||void 0===s?void 0:s.toUpperCase())||"PENDING",l="Low"===e.priority?"LOW":"Medium"===e.priority?"MEDIUM":"High"===e.priority?"HIGH":"Urgent"===e.priority?"URGENT":(null===(r=e.priority)||void 0===r?void 0:r.toUpperCase())||"MEDIUM";le({orderId:e.orderId||"",customer:e.customer||"",deliveryAddress:e.deliveryAddress||"",status:a,priority:l,estimatedDeliveryDate:e.estimatedDeliveryDate?new Date(e.estimatedDeliveryDate).toISOString().split("T")[0]:"",notes:e.notes||"",deliverer:(null===(t=e.deliverer)||void 0===t?void 0:t._id)||""}),U(!0)},ue=()=>{const e=new Date;e.setDate(e.getDate()+1);const s=e.toISOString().split("T")[0];le({orderId:"",customer:"",deliveryAddress:"",status:"PENDING",priority:"MEDIUM",estimatedDeliveryDate:s,notes:"",deliverer:""}),M(null)},xe=e=>{let{status:s}=e;const r="PENDING"===s?"Pending":"IN_TRANSIT"===s?"In Transit":"DELIVERED"===s?"Delivered":"CANCELLED"===s?"Cancelled":s;return(0,A.jsx)(y.E,{className:{Pending:"bg-yellow-100 text-yellow-800","In Transit":"bg-blue-100 text-blue-800",Delivered:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800",PENDING:"bg-yellow-100 text-yellow-800",IN_TRANSIT:"bg-blue-100 text-blue-800",DELIVERED:"bg-green-100 text-green-800",CANCELLED:"bg-red-100 text-red-800"}[r]||"bg-gray-100 text-gray-800",children:r})},ge=e=>{let{priority:s}=e;const r="HIGH"===s?"High":"MEDIUM"===s?"Medium":"LOW"===s?"Low":"URGENT"===s?"Urgent":s;return(0,A.jsx)(y.E,{className:{Low:"bg-blue-100 text-blue-800",Medium:"bg-yellow-100 text-yellow-800",High:"bg-orange-100 text-orange-800",Urgent:"bg-red-100 text-red-800",LOW:"bg-blue-100 text-blue-800",MEDIUM:"bg-yellow-100 text-yellow-800",HIGH:"bg-orange-100 text-orange-800",URGENT:"bg-red-100 text-red-800"}[r]||"bg-gray-100 text-gray-800",children:r})};return f&&0===s.length?(0,A.jsx)(h.A,{}):D&&0===s.length?(0,A.jsx)(v.A,{message:D,onRetry:()=>window.location.reload()}):(0,A.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-6",children:[(0,A.jsxs)("div",{className:"mb-8 flex flex-col gap-6 rounded-xl bg-card p-6 shadow md:flex-row md:items-start md:justify-between",children:[(0,A.jsxs)("div",{children:[(0,A.jsxs)("h1",{className:"flex items-center gap-2 text-2xl font-bold",children:[(0,A.jsx)(a.A,{className:"h-6 w-6 text-primary"}),e("title")]}),(0,A.jsx)("p",{className:"text-muted-foreground",children:e("deliveryDetails")})]}),(0,A.jsxs)("div",{className:"flex gap-2",children:[(0,A.jsxs)(E.$,{variant:"outline",size:"sm",onClick:ne,disabled:f,className:"flex items-center gap-2",children:[(0,A.jsx)(l.A,{className:f?"h-4 w-4 animate-spin":"h-4 w-4"}),e("common:refresh")]}),(0,A.jsxs)(E.$,{onClick:()=>{_("create"),ue();const e=new Date;e.setDate(e.getDate()+1);const s=e.toISOString().split("T")[0];le((e=>({...e,estimatedDeliveryDate:s,status:"PENDING"}))),U(!0)},size:"sm",className:"flex items-center gap-2",children:[(0,A.jsx)(i.A,{className:"h-4 w-4"})," ",e("newDelivery")]})]})]}),(0,A.jsxs)("div",{className:"mb-6 flex flex-col items-start justify-between gap-4 md:flex-row md:items-center",children:[(0,A.jsxs)("div",{className:"relative w-full md:max-w-md",children:[(0,A.jsx)(d.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,A.jsx)(C.p,{type:"text",placeholder:e("deliveries:destinationPlaceholder"),value:B,onChange:e=>K(e.target.value),className:"pl-10"})]}),(0,A.jsxs)("div",{className:"flex items-center gap-2",children:[(0,A.jsxs)(E.$,{variant:re?"default":"outline",size:"sm",className:"flex items-center gap-2",onClick:()=>te(!re),children:[(0,A.jsx)(n.A,{className:"h-4 w-4"}),e("common:filter")]}),(J||Y||ee)&&(0,A.jsxs)(E.$,{variant:"destructive",size:"sm",className:"flex items-center gap-2",onClick:()=>{X(""),Q(""),se(""),K(""),O(1)},children:[(0,A.jsx)(o.A,{className:"h-4 w-4"}),e("common:clear")]})]})]}),re&&(0,A.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-6 rounded-xl bg-card p-6 shadow md:grid-cols-3",children:[(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium",children:e("status")}),(0,A.jsxs)(S.l,{value:J,onChange:e=>X(e.target.value),children:[(0,A.jsx)("option",{value:"",children:e("filters.all")}),(0,A.jsx)("option",{value:"Pending",children:e("statuses.pending")}),(0,A.jsx)("option",{value:"In Transit",children:e("statuses.inTransit")}),(0,A.jsx)("option",{value:"Delivered",children:e("statuses.delivered")}),(0,A.jsx)("option",{value:"Cancelled",children:e("statuses.cancelled")})]})]}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium",children:e("priority")}),(0,A.jsxs)(S.l,{value:Y,onChange:e=>Q(e.target.value),children:[(0,A.jsx)("option",{value:"",children:e("filters.all")}),(0,A.jsx)("option",{value:"Low",children:e("priorities.low")}),(0,A.jsx)("option",{value:"Medium",children:e("priorities.medium")}),(0,A.jsx)("option",{value:"High",children:e("priorities.high")}),(0,A.jsx)("option",{value:"Urgent",children:e("priorities.urgent")})]})]}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium",children:e("deliverer")}),(0,A.jsxs)(S.l,{value:ee,onChange:e=>se(e.target.value),children:[(0,A.jsx)("option",{value:"",children:e("filters.all")}),j.map((e=>(0,A.jsx)("option",{value:e._id,children:e.name},e._id)))]})]})]}),(0,A.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,A.jsx)(R.Zp,{children:(0,A.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,A.jsx)("span",{className:"text-3xl font-bold",children:W}),(0,A.jsx)("span",{className:"text-sm text-muted-foreground",children:e("deliveriesTotal",{ns:"dashboard"})})]})}),(0,A.jsx)(R.Zp,{children:(0,A.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,A.jsx)("span",{className:"text-3xl font-bold",children:ce.filter((e=>"PENDING"===e.status||"Pending"===e.status)).length}),(0,A.jsx)("span",{className:"text-sm text-muted-foreground",children:e("statuses.pending")})]})}),(0,A.jsx)(R.Zp,{children:(0,A.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,A.jsx)("span",{className:"text-3xl font-bold",children:ce.filter((e=>"IN_TRANSIT"===e.status||"In Transit"===e.status)).length}),(0,A.jsx)("span",{className:"text-sm text-muted-foreground",children:e("statuses.inTransit")})]})}),(0,A.jsx)(R.Zp,{children:(0,A.jsxs)(R.Wu,{className:"flex flex-col items-center justify-center pt-6",children:[(0,A.jsx)("span",{className:"text-3xl font-bold",children:ce.filter((e=>"DELIVERED"===e.status||"Delivered"===e.status)).length}),(0,A.jsx)("span",{className:"text-sm text-muted-foreground",children:e("statuses.delivered")})]})})]}),(0,A.jsx)(k,{data:ce,loading:f,onView:e=>{M(e),G(!0)},onEdit:me,onDelete:async e=>{if(window.confirm("Are you sure you want to delete this delivery?"))try{const s="object"===typeof e?e._id:e;if(!s)return console.error("Invalid delivery ID:",s),void u.oR.error("Cannot delete delivery: Invalid ID");console.log(`Deleting delivery with ID: ${s}`),await g.ZR.delete(s),u.oR.success("Delivery deleted successfully!"),ne()}catch(s){console.error("Error deleting delivery:",s),u.oR.error(`Failed to delete delivery: ${s.message||"Unknown error"}`)}},userRole:ie}),z>1&&(0,A.jsxs)("div",{className:"mb-6 flex items-center justify-between py-4",children:[(0,A.jsxs)(E.$,{variant:"outline",size:"sm",onClick:()=>O((e=>Math.max(e-1,1))),disabled:1===V,className:"flex items-center gap-1",children:[(0,A.jsx)(c.A,{className:"h-4 w-4"}),e("common:previous")]}),(0,A.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e("common:page")," ",V," ",e("common:of")," ",z," (",W," ",e("common:total"),")"]}),(0,A.jsxs)(E.$,{variant:"outline",size:"sm",onClick:()=>O((e=>Math.min(e+1,z))),disabled:V===z,className:"flex items-center gap-1",children:[e("common:next"),(0,A.jsx)(m.A,{className:"h-4 w-4"})]})]}),P&&(0,A.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:(0,A.jsxs)("div",{className:"max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-lg bg-white p-6 text-black shadow-xl dark:bg-gray-800 dark:text-white",children:[(0,A.jsxs)("div",{className:"mb-4 flex items-center justify-between border-b border-gray-200 pb-4 dark:border-gray-700",children:[(0,A.jsx)("h3",{className:"text-xl font-semibold",children:e("create"===H?"newDelivery":"editDelivery")}),(0,A.jsx)("button",{className:"rounded-full p-1 hover:bg-muted",onClick:()=>U(!1),children:(0,A.jsx)(o.A,{size:24})})]}),(0,A.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),console.log("Delivery form submission triggered");try{var s;if(b(!0),!ae.customer.trim())return console.log("Validation error: Customer name is required"),u.oR.error("Customer name is required"),void b(!1);if(!ae.deliveryAddress.trim())return console.log("Validation error: Delivery address is required"),u.oR.error("Delivery address is required"),void b(!1);const e=new Date(ae.estimatedDeliveryDate),l=new Date;if(l.setHours(0,0,0,0),e<l)return console.log("Validation error: Estimated delivery date must be in the future"),u.oR.error("Estimated delivery date must be in the future"),void b(!1);const i=e=>{switch(e){case"PENDING":return"Pending";case"IN_TRANSIT":return"In Transit";case"DELIVERED":return"Delivered";case"CANCELLED":return"Cancelled";default:return e}},d=e=>{switch(e){case"LOW":return"Low";case"MEDIUM":return"Medium";case"HIGH":return"High";case"URGENT":return"Urgent";default:return e}},n="create"===H?{customer:ae.customer,deliveryAddress:ae.deliveryAddress,status:i(ae.status),priority:d(ae.priority),estimatedDeliveryDate:ae.estimatedDeliveryDate?new Date(ae.estimatedDeliveryDate).toISOString():void 0,notes:ae.notes,deliverer:ae.deliverer||void 0}:{...ae,status:i(ae.status),priority:d(ae.priority),estimatedDeliveryDate:ae.estimatedDeliveryDate?new Date(ae.estimatedDeliveryDate).toISOString():void 0,deliverer:ae.deliverer||void 0};console.log("Prepared submission data:",n);const o="edit"===H?null===(s=I.deliverer)||void 0===s?void 0:s._id:null;if("create"===H){console.log("Creating delivery with data:",n);try{const e=localStorage.getItem("authToken");console.log("Auth token exists:",!!e,e?`Length: ${e.length}`:"");const s=await g.ZR.create(n);console.log("Created delivery:",s),u.oR.success("Delivery created successfully!"),U(!1),ue(),setTimeout((()=>{ne()}),300)}catch(a){console.error("Error creating delivery:",a),console.error("Error details:",JSON.stringify(a,null,2)),a.data&&a.data.errors&&Array.isArray(a.data.errors)?(console.log("Validation errors from API:",a.data.errors),a.data.errors.forEach((e=>{u.oR.error(`${e.field}: ${e.message}`)}))):a.data&&a.data.message?(console.log("Error message from API:",a.data.message),u.oR.error(a.data.message)):a.message?(console.log("Error message:",a.message),u.oR.error(a.message)):(console.log("Unknown error format:",a),u.oR.error("Failed to create delivery. Please check your input and try again.")),b(!1)}}else{console.log("Updating delivery with data:",n);try{if(await g.ZR.update(I._id,n),u.oR.success("Delivery updated successfully!"),ae.deliverer&&ae.deliverer!==o)try{await g.l1.updateStatus(ae.deliverer,"Busy"),console.log(`Updated deliverer ${ae.deliverer} status to Busy`)}catch(a){console.error("Error updating deliverer status:",a)}if(o&&o!==ae.deliverer)try{await g.l1.updateStatus(o,"Available"),console.log(`Updated deliverer ${o} status to Available`)}catch(a){console.error("Error updating deliverer status:",a)}U(!1),ue(),ne()}catch(a){var r,t;console.error("Error updating delivery:",a),null!==(r=a.response)&&void 0!==r&&null!==(t=r.data)&&void 0!==t&&t.message?u.oR.error(a.response.data.message):a.message?u.oR.error(a.message):u.oR.error("Failed to update delivery"),b(!1)}}}catch(a){console.error("Unexpected error:",a),u.oR.error("An unexpected error occurred"),b(!1)}},className:"space-y-4",children:["edit"===H&&(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("deliveryID")," *"]}),(0,A.jsx)("input",{type:"text",value:ae.orderId,onChange:e=>le({...ae,orderId:e.target.value}),required:!0,disabled:!0,placeholder:e("common:autoGenerated"),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700"})]}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("customer")," *"]}),(0,A.jsx)("input",{type:"text",value:ae.customer,onChange:e=>le({...ae,customer:e.target.value}),required:!0,placeholder:e("customerPlaceholder"),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700"})]})]}),"create"===H&&(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("customer")," *"]}),(0,A.jsx)("input",{type:"text",value:ae.customer,onChange:e=>le({...ae,customer:e.target.value}),required:!0,placeholder:e("customerPlaceholder"),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700"})]}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("destination")}),(0,A.jsx)(p.A,{value:ae.deliveryAddress,onChange:e=>le({...ae,deliveryAddress:e}),placeholder:e("destinationPlaceholder"),disabled:f}),(0,A.jsx)("small",{className:"text-xs text-muted-foreground",children:e("deliverers:startTypingForSuggestions")})]}),(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:["edit"===H&&(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("status")}),(0,A.jsxs)("select",{value:ae.status,onChange:e=>le({...ae,status:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700",children:[(0,A.jsx)("option",{value:"PENDING",children:e("statuses.pending")}),(0,A.jsx)("option",{value:"IN_TRANSIT",children:e("statuses.inTransit")}),(0,A.jsx)("option",{value:"DELIVERED",children:e("statuses.delivered")}),(0,A.jsx)("option",{value:"CANCELLED",children:e("statuses.cancelled")})]})]}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("priority")}),(0,A.jsxs)("select",{value:ae.priority,onChange:e=>le({...ae,priority:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700",children:[(0,A.jsx)("option",{value:"LOW",children:e("priorities.low")}),(0,A.jsx)("option",{value:"MEDIUM",children:e("priorities.medium")}),(0,A.jsx)("option",{value:"HIGH",children:e("priorities.high")}),(0,A.jsx)("option",{value:"URGENT",children:e("priorities.urgent")})]})]})]}),(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsxs)("label",{className:"text-sm font-medium dark:text-gray-200",children:[e("scheduledDate")," *"]}),(0,A.jsx)("input",{type:"date",value:ae.estimatedDeliveryDate,onChange:e=>le({...ae,estimatedDeliveryDate:e.target.value}),min:(new Date).toISOString().split("T")[0],required:!0,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700"}),(0,A.jsx)("small",{className:"text-xs text-muted-foreground",children:e("common:mustBeFutureDate")})]}),"admin"===ie&&(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("deliverer")}),(0,A.jsxs)("select",{value:ae.deliverer,onChange:e=>le({...ae,deliverer:e.target.value}),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700",children:[(0,A.jsx)("option",{value:"",children:e("unassigned")}),j.filter((e=>"Available"===e.status)).map((e=>(0,A.jsxs)("option",{value:e._id,children:[e.name," - ",e.email]},e._id)))]}),0===j.filter((e=>"Available"===e.status)).length&&(0,A.jsx)("small",{className:"text-xs text-warning",children:e("common:noAvailableDeliverers")})]})]}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("label",{className:"text-sm font-medium dark:text-gray-200",children:e("notes")}),(0,A.jsx)("textarea",{value:ae.notes,onChange:e=>le({...ae,notes:e.target.value}),placeholder:e("notesPlaceholder"),rows:"3",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-foreground dark:border-gray-600 dark:bg-gray-700"})]}),(0,A.jsxs)("div",{className:"flex justify-end space-x-3 border-t border-gray-200 pt-4 dark:border-gray-700",children:[(0,A.jsx)(E.$,{type:"button",variant:"outline",onClick:()=>U(!1),children:e("deliverers:cancel")}),(0,A.jsx)(E.$,{type:"submit",disabled:f,children:f?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(l.A,{className:"mr-2 h-4 w-4 animate-spin"}),e("create"===H?"common:creating":"common:updating")]}):e("create"===H?"newDelivery":"editDelivery")})]})]})]})}),$&&I&&(0,A.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:(0,A.jsxs)("div",{className:"max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-lg bg-white p-6 text-black shadow-xl dark:bg-gray-800 dark:text-white",children:[(0,A.jsxs)("div",{className:"mb-4 flex items-center justify-between border-b border-gray-200 pb-4 dark:border-gray-700",children:[(0,A.jsx)("h3",{className:"text-xl font-semibold",children:e("deliveryDetails")}),(0,A.jsx)("button",{className:"rounded-full p-1 hover:bg-muted",onClick:()=>G(!1),children:(0,A.jsx)(o.A,{size:24})})]}),(0,A.jsxs)("div",{className:"space-y-6",children:[(0,A.jsxs)("div",{className:"space-y-3",children:[(0,A.jsx)("h4",{className:"text-lg font-medium",children:e("common:basicInfo")}),(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("deliveryID")}),(0,A.jsx)("p",{className:"font-medium",children:I.orderId})]}),(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("customer")}),(0,A.jsx)("p",{className:"font-medium",children:I.customer})]}),(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("status")}),(0,A.jsx)("div",{children:(0,A.jsx)(xe,{status:I.status})})]}),(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("priority")}),(0,A.jsx)("div",{children:(0,A.jsx)(ge,{priority:I.priority})})]})]})]}),(0,A.jsxs)("div",{className:"space-y-3",children:[(0,A.jsx)("h4",{className:"text-lg font-medium",children:e("deliveryInformation")}),(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("deliveryAddress")}),(0,A.jsx)("p",{className:"font-medium",children:I.deliveryAddress||"No address provided"})]}),(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("estimatedDate")}),(0,A.jsx)("p",{className:"font-medium",children:I.estimatedDeliveryDate?new Date(I.estimatedDeliveryDate).toLocaleDateString():"Not set"})]}),(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("actualDate")}),(0,A.jsx)("p",{className:"font-medium",children:I.actualDeliveryDate?new Date(I.actualDeliveryDate).toLocaleDateString():"Not delivered yet"})]})]})]})]}),(0,A.jsxs)("div",{className:"space-y-3",children:[(0,A.jsx)("h4",{className:"text-lg font-medium",children:e("assignmentTracking")}),(0,A.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("assignedDeliverer")}),(0,A.jsx)("p",{className:"font-medium",children:I.deliverer?`${I.deliverer.name} (${I.deliverer.email})`:"Unassigned"})]}),(0,A.jsxs)("div",{className:"space-y-1",children:[(0,A.jsx)("label",{className:"text-sm text-muted-foreground",children:e("createdDate")}),(0,A.jsx)("p",{className:"font-medium",children:new Date(I.createdAt).toLocaleDateString()})]})]})]}),I.notes&&(0,A.jsxs)("div",{className:"space-y-3",children:[(0,A.jsx)("h4",{className:"text-lg font-medium",children:e("notes")}),(0,A.jsx)("p",{children:I.notes})]}),(0,A.jsxs)("div",{className:"flex justify-end space-x-3 border-t border-gray-200 pt-4 dark:border-gray-700",children:["admin"===ie&&(0,A.jsx)(E.$,{variant:"outline",onClick:()=>{G(!1),me(I)},children:e("editDelivery")}),(0,A.jsx)(E.$,{onClick:()=>G(!1),children:e("close")})]})]})]})})]})}},7701:(e,s,r)=>{r.d(s,{A:()=>o});var t=r(9643),a=r(2616),l=r(7142),i=r(2732),d=r(3016),n=r(6507);const o=e=>{let{value:s,onChange:r,onSelect:o,placeholder:c="Enter an address",className:m="",inputClassName:u="",disabled:x=!1,required:g=!1,...h}=e;const[v,p]=(0,t.useState)([]),[y,j]=(0,t.useState)(!1),[N,f]=(0,t.useState)(!1),[b,D]=(0,t.useState)(!1),w=(0,t.useRef)(null),I=(0,t.useRef)(null),E=(0,t.useRef)(null);(0,t.useEffect)((()=>{function e(e){I.current&&!I.current.contains(e.target)&&p([])}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);return(0,n.jsxs)("div",{className:`relative ${m}`,...h,children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(a.p,{ref:w,type:"text",value:s||"",onChange:e=>{const s=e.target.value;r&&r(s),E.current&&clearTimeout(E.current),s.length>=3?(j(!0),E.current=setTimeout((()=>{(async e=>{if(e&&!(e.length<3)){j(!0);try{const s=`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(e)}&apiKey=6d177e3213d4451d87c9e1561ee3b8d3&format=json&limit=5`,r=await fetch(s);if(!r.ok)throw new Error(`Geoapify API error: ${r.status}`);const t=await r.json();if(t&&t.results){const e=t.results.map((e=>({formattedAddress:e.formatted,lat:e.lat,lon:e.lon,country:e.country,state:e.state,city:e.city,street:e.street,houseNumber:e.housenumber,postcode:e.postcode,raw:e})));p(e)}else p([])}catch(s){console.error("Error fetching address suggestions:",s),D(!0),p([])}finally{j(!1)}}})(s)}),300)):(p([]),j(!1))},placeholder:b?"Enter address manually":c,className:`pl-10 ${u}`,disabled:x,required:g,onFocus:()=>f(!0),onBlur:()=>setTimeout((()=>f(!1)),200)}),(0,n.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:y?(0,n.jsx)(l.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}):b?(0,n.jsx)(i.A,{className:"h-4 w-4 text-amber-500"}):(0,n.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"})})]}),b&&(0,n.jsx)("div",{className:"mt-1 text-xs text-amber-500",children:"Address autocomplete unavailable. Please enter address manually."}),N&&v.length>0&&(0,n.jsx)("div",{ref:I,className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border bg-white py-1 shadow-lg dark:bg-gray-800 dark:text-white dark:border-gray-700",children:v.map(((e,s)=>(0,n.jsxs)("div",{className:"cursor-pointer px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>(e=>{r&&r(e.formattedAddress),o&&o(e),p([])})(e),children:[(0,n.jsx)("div",{className:"font-medium",children:e.formattedAddress}),e.city&&e.country&&(0,n.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.city,e.state,e.country].filter(Boolean).join(", ")})]},s)))})]})}}}]);
//# sourceMappingURL=707.ca1635c8.chunk.js.map